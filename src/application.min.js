/*! JSON v3.3.2 | http://bestiejs.github.io/json3 | Copyright 2012-2014, Kit Cambridge | http://kit.mit-license.org */
(function(){function d(ax,at){function av(x){if(av[x]!==aj){return av[x]}var v;if("bug-string-char-index"==x){v="a"!="a"[0]}else{if("json"==x){v=av("json-stringify")&&av("json-parse")}else{var t;if("json-stringify"==x){v=at.stringify;var w="function"==typeof v&&aq;if(w){(t=function(){return 1}).toJSON=t;try{w="0"===v(0)&&"0"===v(new ao)&&'""'==v(new aw)&&v(am)===aj&&v(aj)===aj&&v()===aj&&"1"===v(t)&&"[1]"==v([t])&&"[null]"==v([aj])&&"null"==v(null)&&"[null,null,null]"==v([aj,am,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==v({a:[t,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===v(null,t)&&"[\n 1,\n 2\n]"==v([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==v(new ar(-8640000000000000))&&'"+275760-09-13T00:00:00.000Z"'==v(new ar(8640000000000000))&&'"-000001-01-01T00:00:00.000Z"'==v(new ar(-62198755200000))&&'"1969-12-31T23:59:59.999Z"'==v(new ar(-1))}catch(s){w=!1}}v=w}if("json-parse"==x){v=at.parse;if("function"==typeof v){try{if(0===v("0")&&!v(!1)){t=v('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var p=5==t.a.length&&1===t.a[0];if(p){try{p=!v('"\t"')}catch(u){}if(p){try{p=1!==v("01")}catch(r){}}if(p){try{p=1!==v("1.")}catch(q){}}}}}catch(l){p=!1}}v=p}}}return av[x]=!!v}ax||(ax=b.Object());at||(at=b.Object());var ao=ax.Number||b.Number,aw=ax.String||b.String,ai=ax.Object||b.Object,ar=ax.Date||b.Date,ak=ax.SyntaxError||b.SyntaxError,ad=ax.TypeError||b.TypeError,ab=ax.Math||b.Math,ah=ax.JSON||b.JSON;"object"==typeof ah&&ah&&(at.stringify=ah.stringify,at.parse=ah.parse);var ai=ai.prototype,am=ai.toString,al,au,aj,aq=new ar(-3509827334573292);try{aq=-109252==aq.getUTCFullYear()&&0===aq.getUTCMonth()&&1===aq.getUTCDate()&&10==aq.getUTCHours()&&37==aq.getUTCMinutes()&&6==aq.getUTCSeconds()&&708==aq.getUTCMilliseconds()}catch(X){}if(!av("json")){var ap=av("bug-string-char-index");if(!aq){var ag=ab.floor,aa=[0,31,59,90,120,151,181,212,243,273,304,334],an=function(l,p){return aa[p]+365*(l-1970)+ag((l-1969+(p=+(1<p)))/4)-ag((l-1901+p)/100)+ag((l-1601+p)/400)}}(al=ai.hasOwnProperty)||(al=function(l){var q={},p;(q.__proto__=null,q.__proto__={toString:1},q).toString!=am?al=function(r){var s=this.__proto__;r=r in (this.__proto__=null,this);this.__proto__=s;return r}:(p=q.constructor,al=function(r){var s=(this.constructor||p).prototype;return r in this&&!(r in s&&this[r]===s[r])});q=null;return al.call(this,l)});au=function(p,t){var r=0,l,q,s;(l=function(){this.valueOf=0}).prototype.valueOf=0;q=new l;for(s in q){al.call(q,s)&&r++}l=q=null;r?au=2==r?function(v,y){var x={},u="[object Function]"==am.call(v),w;for(w in v){u&&"prototype"==w||al.call(x,w)||!(x[w]=1)||!al.call(v,w)||y(w)}}:function(v,y){var x="[object Function]"==am.call(v),u,w;for(u in v){x&&"prototype"==u||!al.call(v,u)||(w="constructor"===u)||y(u)}(w||al.call(v,u="constructor"))&&y(u)}:(q="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),au=function(v,y){var x="[object Function]"==am.call(v),u,w=!x&&"function"!=typeof v.constructor&&i[typeof v.hasOwnProperty]&&v.hasOwnProperty||al;for(u in v){x&&"prototype"==u||!w.call(v,u)||y(u)}for(x=q.length;u=q[--x];w.call(v,u)&&y(u)){}});return au(p,t)};if(!av("json-stringify")){var n={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},af=function(l,p){return("000000"+(p||0)).slice(-l)},N=function(p){for(var u='"',l=0,q=p.length,r=!ap||10<q,t=r&&(ap?p.split(""):p);l<q;l++){var s=p.charCodeAt(l);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:u+=n[s];break;default:if(32>s){u+="\\u00"+af(2,s.toString(16));break}u+=r?t[l]:p.charAt(l)}}return u+'"'},Z=function(K,I,J,C,E,x,G){var D,y,B,A,w,u,M,L,v;try{D=I[K]}catch(H){}if("object"==typeof D&&D){if(y=am.call(D),"[object Date]"!=y||al.call(D,"toJSON")){"function"==typeof D.toJSON&&("[object Number]"!=y&&"[object String]"!=y&&"[object Array]"!=y||al.call(D,"toJSON"))&&(D=D.toJSON(K))}else{if(D>-1/0&&D<1/0){if(an){A=ag(D/86400000);for(y=ag(A/365.2425)+1970-1;an(y+1,0)<=A;y++){}for(B=ag((A-an(y,0))/30.42);an(y,B+1)<=A;B++){}A=1+A-an(y,B);w=(D%86400000+86400000)%86400000;u=ag(w/3600000)%24;M=ag(w/60000)%60;L=ag(w/1000)%60;w%=1000}else{y=D.getUTCFullYear(),B=D.getUTCMonth(),A=D.getUTCDate(),u=D.getUTCHours(),M=D.getUTCMinutes(),L=D.getUTCSeconds(),w=D.getUTCMilliseconds()}D=(0>=y||10000<=y?(0>y?"-":"+")+af(6,0>y?-y:y):af(4,y))+"-"+af(2,B+1)+"-"+af(2,A)+"T"+af(2,u)+":"+af(2,M)+":"+af(2,L)+"."+af(3,w)+"Z"}else{D=null}}}J&&(D=J.call(I,K,D));if(null===D){return"null"}y=am.call(D);if("[object Boolean]"==y){return""+D}if("[object Number]"==y){return D>-1/0&&D<1/0?""+D:"null"}if("[object String]"==y){return N(""+D)}if("object"==typeof D){for(K=G.length;K--;){if(G[K]===D){throw ad()}}G.push(D);v=[];I=x;x+=E;if("[object Array]"==y){B=0;for(K=D.length;B<K;B++){y=Z(B,D,J,C,E,x,G),v.push(y===aj?"null":y)}K=v.length?E?"[\n"+x+v.join(",\n"+x)+"\n"+I+"]":"["+v.join(",")+"]":"[]"}else{au(C||D,function(l){var p=Z(l,D,J,C,E,x,G);p!==aj&&v.push(N(l)+":"+(E?" ":"")+p)}),K=v.length?E?"{\n"+x+v.join(",\n"+x)+"\n"+I+"}":"{"+v.join(",")+"}":"{}"}G.pop();return K}};at.stringify=function(y,w,x){var s,u,p,v;if(i[typeof w]&&w){if("[object Function]"==(v=am.call(w))){u=w}else{if("[object Array]"==v){p={};for(var t=0,r=w.length,q;t<r;q=w[t++],(v=am.call(q),"[object String]"==v||"[object Number]"==v)&&(p[q]=1)){}}}}if(x){if("[object Number]"==(v=am.call(x))){if(0<(x-=x%1)){for(s="",10<x&&(x=10);s.length<x;s+=" "){}}}else{"[object String]"==v&&(s=10>=x.length?x:x.slice(0,10))}}return Z("",(q={},q[""]=y,q),u,p,s,"",[])}}if(!av("json-parse")){var m=aw.fromCharCode,k={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},az,ae,ay=function(){az=ae=null;throw ak()},ac=function(){for(var l=ae,u=l.length,s,q,r,p,t;az<u;){switch(t=l.charCodeAt(az),t){case 9:case 10:case 13:case 32:az++;break;case 123:case 125:case 91:case 93:case 58:case 44:return s=ap?l.charAt(az):l[az],az++,s;case 34:s="@";for(az++;az<u;){if(t=l.charCodeAt(az),32>t){ay()}else{if(92==t){switch(t=l.charCodeAt(++az),t){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:s+=k[t];az++;break;case 117:q=++az;for(r=az+4;az<r;az++){t=l.charCodeAt(az),48<=t&&57>=t||97<=t&&102>=t||65<=t&&70>=t||ay()}s+=m("0x"+l.slice(q,az));break;default:ay()}}else{if(34==t){break}t=l.charCodeAt(az);for(q=az;32<=t&&92!=t&&34!=t;){t=l.charCodeAt(++az)}s+=l.slice(q,az)}}}if(34==l.charCodeAt(az)){return az++,s}ay();default:q=az;45==t&&(p=!0,t=l.charCodeAt(++az));if(48<=t&&57>=t){for(48==t&&(t=l.charCodeAt(az+1),48<=t&&57>=t)&&ay();az<u&&(t=l.charCodeAt(az),48<=t&&57>=t);az++){}if(46==l.charCodeAt(az)){for(r=++az;r<u&&(t=l.charCodeAt(r),48<=t&&57>=t);r++){}r==az&&ay();az=r}t=l.charCodeAt(az);if(101==t||69==t){t=l.charCodeAt(++az);43!=t&&45!=t||az++;for(r=az;r<u&&(t=l.charCodeAt(r),48<=t&&57>=t);r++){}r==az&&ay();az=r}return +l.slice(q,az)}p&&ay();if("true"==l.slice(az,az+4)){return az+=4,!0}if("false"==l.slice(az,az+5)){return az+=5,!1}if("null"==l.slice(az,az+4)){return az+=4,null}ay()}}return"$"},Y=function(p){var q,l;"$"==p&&ay();if("string"==typeof p){if("@"==(ap?p.charAt(0):p[0])){return p.slice(1)}if("["==p){for(q=[];;l||(l=!0)){p=ac();if("]"==p){break}l&&(","==p?(p=ac(),"]"==p&&ay()):ay());","==p&&ay();q.push(Y(p))}return q}if("{"==p){for(q={};;l||(l=!0)){p=ac();if("}"==p){break}l&&(","==p?(p=ac(),"}"==p&&ay()):ay());","!=p&&"string"==typeof p&&"@"==(ap?p.charAt(0):p[0])&&":"==ac()||ay();q[p.slice(1)]=Y(ac())}return q}ay()}return p},o=function(p,l,q){q=F(p,l,q);q===aj?delete p[l]:p[l]=q},F=function(p,l,s){var q=p[l],r;if("object"==typeof q&&q){if("[object Array]"==am.call(q)){for(r=q.length;r--;){o(q,r,s)}}else{au(q,function(t){o(q,t,s)})}}return s.call(p,l,q)};at.parse=function(l,r){var q,p;az=0;ae=""+l;q=Y(ac());"$"!=ac()&&ay();az=ae=null;return r&&"[object Function]"==am.call(r)?F((p={},p[""]=q,p),"",r):q}}}at.runInContext=d;return at}var g=typeof define==="function"&&define.amd,i={"function":!0,object:!0},h=i[typeof exports]&&exports&&!exports.nodeType&&exports,b=i[typeof window]&&window||this,j=h&&i[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;!j||j.global!==j&&j.window!==j&&j.self!==j||(b=j);if(h&&!g){d(b,h)}else{var f=b.JSON,c=b.JSON3,e=!1,a=d(b,b.JSON3={noConflict:function(){e||(e=!0,b.JSON=f,b.JSON3=c,f=c=null);return a}});b.JSON={parse:a.parse,stringify:a.stringify}}g&&define(function(){return a})}).call(this);$={domReady:function(a){if(document.addEventListener){document.addEventListener("DOMContentLoaded",a)}else{document.attachEvent("onreadystatechange",function(){if(document.readyState==="interactive"){a()}})}},each:function(c,b){for(var a=0;a<c.length;a++){b(a,c[a])}},guid:function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}};GameStorage={canStore:function(){try{return"localStorage" in window&&window.localStorage!==null}catch(a){return false}},store:function(a,b){return localStorage.setItem(a,b)},get:function(a){return localStorage.getItem(a)},keyExists:function(a){return localStorage.getItem(a)!==null}};Flash.prototype={show:function(){var a=this;this.message.style.display="block";var b=setTimeout(function(){a.message.style.display="none";clearTimeout(b)},this.time)}};function Flash(a,b){this.message=document.getElementById(a);this.time=b||2000}Popup.prototype={show:function(){this.popup.style.display="block";this.openCallback()},hide:function(){this.popup.style.display="none";this.closeCallback()},addCloseListener:function(){var a=this;this.closeButton.onclick=function(){a.hide()}}};function Popup(b,a,c){this.popup=document.getElementById(b);this.closeButton=document.getElementById(b+"-close");this.openCallback=a||function(){};this.closeCallback=c||function(){};this.addCloseListener()}Bar.prototype={fillBar:function(){move(this.bar).set("width","100%").ease("in").duration(this.interval).end()},resetBar:function(){move(this.bar).duration(0).set("width","0px").end();this.fillBar()}};function Bar(b,a){this.bar=b;this.interval=a}SquirrelCity={openDoor:function(){var a=dom.find("#squirrel-warning button#enter-the-house");var b=new Popup("squirrel-warning");b.show();a.onclick=function(){window.currentGame.levels.squirrel_city_first_level.addToGame();b.hide()}}};ExperiencePoints={"9":[{callback_method:"increaseHitPoints",amount:10}],"19":[{callback_method:"increaseHitPoints",amount:20}],"49":[{callback_method:"increaseHitPoints",amount:20}]};ExperienceCallbacks={increaseExperience:function(a){GameData.player.experience+=a;ExperienceCallbacks.checkExperiencePoints()},increaseHitPoints:function(a){GameData.player.hp+=a},checkExperiencePoints:function(){var a=GameData.player.experience;$.each(window.currentGame.callbacks.experienceCallbacks.experienceCallbacks,function(b){if(a>parseInt(b)){$.each(ExperiencePoints[b],function(c,d){window.currentGame.callbacks.experienceCallbacks[d.callback_method](d.amount)})}})},experienceCallbacks:function(){var a=Object.keys(ExperiencePoints).filter(function(b){return parseInt(b)>GameData.player.experience});return a}};StatsCallbacks={seashell:{performCallback:function(a){if(a>0&&!window.currentGame.checkProgressOn("show_fish")){window.currentGame.callbacks.statsCallbacks.seashell.showFish()}else{if(a>19&&!window.currentGame.checkProgressOn("show_bottle")){window.currentGame.callbacks.statsCallbacks.seashell.showMessageInABottle()}else{if(a>999&&!window.currentGame.checkProgressOn("show_shark")){window.currentGame.callbacks.statsCallbacks.seashell.addShark()}}}},addShark:function(){GameData.progress.show_shark=1;$.each(document.querySelectorAll("span.big-shark-part"),function(a,b){b.style.display="inline-block"})},showMapPopup:function(){window.currentGame.mapPopUp=new Popup("map-popup");window.currentGame.mapPopUp.show()},showMessageInABottle:function(){GameData.progress.show_bottle=1;var a=new InventoryItem("A partial map of the world","map",window.currentGame.callbacks.statsCallbacks.seashell.showMapPopup);window.currentGame.messageInABottle=new Item("message-in-a-bottle",function(){var b=new Popup("message-in-a-bottle-popup",undefined,function(){window.currentGame.messageInABottle.clearOnClickMethod();dom.find(".message-in-a-bottle .message").innerHTML="&nbsp;";window.currentGame.player.inventory.addItem("items",a)});b.show()});window.currentGame.messageInABottle.add()},showFish:function(){GameData.progress.show_fish=1;var a=new Character("fish",{initialize:function(){var b=this;var c=document.getElementById("fish-seller-buy-button");this.itemsForSale=document.querySelectorAll(".sell-items li");this.initialfishSellerPopUp=new Popup("fish-seller-popup");this.fishBuyPopUp=new Popup("fish-seller-buy-popup",function(){b.checkFishInventory()},function(){b.initialfishSellerPopUp.hide()});c.onclick=function(){b.fishBuyPopUp.show()};this.addBuyListeners()},click:function(){this.initialfishSellerPopUp.show()},checkFishInventory:function(){$.each(this.itemsForSale,function(b,c){var d=c.getAttribute("name");if(window.currentGame.player.canBuyItem(d)){c.classList.remove("disabled")}else{c.classList.add("disabled")}})},addBuyListeners:function(){var b=this;$.each(this.itemsForSale,function(c,d){d.onclick=function(){var e=d.getAttribute("name");window.currentGame.player.buy(e);b.checkFishInventory()}})}});a.add()}},oyster:{performCallback:function(a){}},wood:{performCallback:function(a){if(a>0&&!window.currentGame.checkProgressOn("show_build_bridge_button")){window.currentGame.callbacks.statsCallbacks.wood.showBuildBridgeButton()}},showBuildBridgeButton:function(){var a=dom.find("#island-bridge-popup #build-island-bridge");var c=new Popup("island-bridge-popup",function(){if(GameData.player.woods>=100&&!window.currentGame.checkProgressOn("enable_build_bridge_button")&&window.currentGame.checkProgressOn("show_bottle")){GameData.progress.enable_build_bridge_button=1;a.removeAttribute("disabled");a.onclick=function(){window.currentStats.increaseStat("wood",-100);window.currentGame.gameMap.showBridge();window.currentGame.gameMap.enableMapSpot("squirrel_city");a.setAttribute("disabled","disabled");a.onclick=null}}});var b=document.getElementById("island-bridge");b.classList.remove("disabled");b.onclick=function(){c.show()}}}};LoadCallbacks={show_fish:function(){window.currentGame.callbacks.statsCallbacks.seashell.showFish()},show_bottle:function(){window.currentGame.callbacks.statsCallbacks.seashell.showMessageInABottle()},show_shark:function(){window.currentGame.callbacks.statsCallbacks.seashell.addShark()},show_build_bridge_button:function(){window.currentGame.callbacks.statsCallbacks.wood.showBuildBridgeButton()},show_stat:function(a){var c=document.getElementById(a+"s");var b=document.getElementById(a+"-count");c.style.display="inline-block";b.innerHTML=GameData.player[a+"s"]},setup_inventory:function(){window.currentGame.player.inventory.checkInventory();for(var a in window.GameData.player.inventory){$.each(window.GameData.player.inventory[a],function(b,c){if(window.currentGame.callbacks.loadCallbacks.inventory[c.identifier+"_callback"]){window.currentGame.callbacks.loadCallbacks.inventory[c.identifier+"_callback"]()}new InventoryItem(c.itemTitle,c.identifier,window.currentGame.callbacks.statsCallbacks.seashell.showMapPopup).add()})}},enable_build_bridge_button:function(){window.currentGame.gameMap.showBridge();window.currentGame.gameMap.enableMapSpot("squirrel_city")},inventory:{map_callback:function(){window.currentGame.messageInABottle.clearOnClickMethod();dom.find(".message-in-a-bottle .message").innerHTML="&nbsp;"}}};Character.prototype={add:function(){this.character.style.display="inline";this.toBeRemovedSpan.style.display="none";this.applyOtherMethods();this.addOnClickMethod();this.addOnInitializeMethod()},addOnClickMethod:function(){if(this.methods&&this.methods.click){this.character.onclick=this.methods.click.bind(this)}},addOnInitializeMethod:function(){if(this.methods&&this.methods.initialize){this.methods.initialize.bind(this)()}},applyOtherMethods:function(){for(method in this.methods){if(!/click|initialize/.test(method)){this[method]=this.methods[method]}}}};function Character(b,a){this.character=document.getElementById(b);this.characterType=this.character.className;this.toBeRemovedSpan=document.getElementById(b+"-remove");this.methods=a}var clickAreas={island:[{id:"island-seashell",note:"First shell where you can click on",klass:"currentStats",method:"increaseStat",args:["seashell",1,StatsCallbacks.seashell.performCallback]},{id:"island-bridge",note:"When you buy your first wood you can build a bridge to the other side"},{id:"battle-big-shark",note:"When something happens ?!",klass:"BattleInitializer",method:"start",args:["tiny-fish"]}],squirrel_city:[{id:"mysterious-squirrel",note:"A mysterious squirrel"},{id:"haunted-house-door",note:"A mysterious squirrel",klass:"SquirrelCity",method:"openDoor"}],squirrel_city_first_level_house:[],squirrel_city_second_level_house:[],squirrel_city_attic_level_house:[]};var ENV="production";var GameData={settings:{},player:{hp:20,mp:0,experience:0,attack_damage:10,battle_timeout:5000,seashells:0,oysters:0,woods:0,armor:null,weapon:null,inventory:{weapons:[],armor:[],skills:[],magic:[],items:[]}},progress:{show_fish:0,show_bottle:0,show_shark:0,show_build_bridge_button:0,enable_build_bridge_button:0}};var sellPrices={oyster:{value:10,type:"seashells"},wood:{value:20,type:"seashells"}};var Enemies={"big-shark":{name:"Shark",health:9999,attack_interval:7500,attacks:{bite:{name:"bite",damage:1000,probability:20},laser:{name:"laser",damage:9999,probability:1}},player_position:{x:460,y:-85},position:{x:0,y:0},rewards:{stats:{seashell:150,oyster:20},items:{sharklaser:1}}},"tiny-fish":{name:"Tiny Fish",health:10,attack_interval:7500,attacks:{bite:{name:"bite",damage:1,probability:1}},player_position:{x:660,y:-30},position:{x:41,y:160},rewards:{stats:{seashell:2}}}};Stats.prototype={increaseStat:function(c,a){var b=document.getElementById(c+"s");var d=document.getElementById(c+"-count");b.style.display="inline-block";window.currentStats.add(c+"s",a);if(window.currentGame.callbacks.statsCallbacks[c].performCallback){window.currentGame.callbacks.statsCallbacks[c].performCallback(GameData.player[c+"s"])}d.innerHTML=GameData.player[c+"s"]},add:function(b,a){GameData.player[b]+=a}};function Stats(){}GameMap.prototype={showBridge:function(){var a=dom.find("#map-popup .map-bridge");a.innerHTML="=="},enableMapSpot:function(a){var b=dom.find("#map-popup #"+a+".map-place");b.classList.add("enabled");b.onclick=function(){b.innerHTML="X";b.classList.remove("enabled");window.currentGame.levels[a].addToGame();window.currentGame.mapPopUp.hide();window.currentGame.inventoryPopUp.hide()}},disableMapSpot:function(a){var b=dom.find("#map-popup #"+a+".map-place");b.classList.remove("enabled");b.onclick=null}};function GameMap(){}Graphic.prototype={addChild:function(c){var b=document.getElementById("game-level");var a=document.createElement("PRE");a.innerHTML=this.asciiString;b.appendChild(a)}};function Graphic(a){this.asciiString=a.join("\n")}Inventory.prototype={getInventory:function(){return GameData.player.inventory},hasSomethingInInventory:function(){var a=this.getInventory();return(a.items.length>0||a.weapons.length>0||a.armor.length>0||a.magic.length>0||a.skills.length>0)},checkInventory:function(){if(GameData.player.inventory.items.length>0){this.setupInventoryButton()}},setupInventoryButton:function(){var a=document.getElementById("open-inventory-button");a.style.display="block";window.currentGame.inventoryPopUp=new Popup("inventory-popup");a.onclick=function(){window.currentGame.inventoryPopUp.show()}},addItem:function(a,b){GameData.player.inventory[a].push(b);b.add();this.checkInventory()}};function Inventory(){}InventoryItem.prototype={add:function(){this.item=this.createItem();document.getElementById("inventory-stash").appendChild(this.item)},createItem:function(){var a=document.createElement("a");a.innerHTML=this.itemTitle;a.onclick=this.onClickMethod;return a}};function InventoryItem(a,b,c){this.itemTitle=a;this.identifier=b;this.onClickMethod=c}Player.prototype={setName:function(a){this.name=a},buy:function(b){var c=sellPrices[b];if(GameData.player[c.type]>=c.value){var a=c.type.substring(0,c.type.length-1);window.currentStats.increaseStat(b,1);window.currentStats.increaseStat(a,(c.value*-1))}},canBuyItem:function(a){var b=GameData.player[sellPrices[a].type];return b>=sellPrices[a].value},attack:function(a){window.currentBattle.battleEngine.disable();window.currentBattle.infoHeader.update("You attacked");var b=this;move(this.battleGraphic).x(a.enemyInformation.player_position.x).y(a.enemyInformation.player_position.y).duration("0.4s").ease("in").end();clearTimeout(this.clearMove);this.attackBar.resetBar();this.clearMove=setTimeout(function(){move(b.battleGraphic).x(0).duration("0.3s").ease("out").end(function(){a.looseHealth(GameData.player.attack_damage)});clearTimeout(b.clearMove)},500)},looseHealth:function(a){GameData.player.hp-=a;if(GameData.player.hp<=0){GameData.player.hp=0;window.currentBattle.endBattle(GameData.player.hp,function(){window.currentBattle.infoHeader.update("You lost!")},function(){GameData.player.hp=1})}this.updateHealthBar()},initiateFight:function(){this.updateHealthBar();this.attackBar.resetBar();this.totalHealth=dom.find(".field .player .health-stats .total-health");this.totalHealth.innerHTML=this.startHealth},updateHealthBar:function(){this.healthBar.style.width=this.currentHealth()+"%";this.healthStats.innerHTML=GameData.player.hp},currentHealth:function(){return(GameData.player.hp/this.startHealth)*100},getGraphic:function(){return this.graphic.innerHTML},spawn:function(){this.playerPlaceholder=dom.find("#battle-sequence-popup .field .player #graphic");this.playerPlaceholder.innerHTML=this.getGraphic()},unspawn:function(){this.playerPlaceholder.innerHTML=""},setCurrentWeapon:function(a){window.GameData.player.weapon=a;this.updateWeaponGraphics(a)},updateWeaponGraphics:function(a){var b=this.graphic.querySelectorAll(".weapon");$.each(window.Weapons[a.identifier].graphic,function(d,c){b[d].innerHTML=c})},setCurrentArmor:function(a){window.GameData.player.armor=a;this.updateArmorGraphics(a)},updateArmorGraphics:function(b){var a=this.graphic.querySelectorAll(".armor");$.each(window.Armors[b.identifier].graphic,function(d,c){a[d].innerHTML=c})},removeArmorAndWeapons:function(){this.updateArmorGraphics({identifier:"none"});this.updateWeaponGraphics({identifier:"none"});window.GameData.player.armor=null;window.GameData.player.weapon=null}};function Player(){this.inventory=new Inventory();this.graphic=document.getElementById("game-character");this.battleGraphic=dom.find("#battle-sequence-popup .player #graphic");this.healthBar=dom.find(".field .player .healthbar .health-left");this.healthStats=dom.find(".field .player .health-stats .health-stats-left");this.startHealth=GameData.player.hp;this.attackBar=new Bar(".field .player .attackbar .attack-left",GameData.player.battle_timeout)}Enemy.prototype={startAttacking:function(){var a=this;this.attackHoldBar.resetBar();this.attackInterval=setInterval(function(){var b=a.pickAttack();a.attackWith(b)},this.enemyInformation.attack_interval)},quitAttacking:function(){clearInterval(this.attackInterval)},pickAttack:function(){var a=[];for(var c in this.enemyInformation.attacks){for(var b=0;b<this.enemyInformation.attacks[c].probability;b++){a.push(this.enemyInformation.attacks[c])}}picked_attack=Math.round(Math.random()*(a.length-1));return a[picked_attack]},attackWith:function(a){window.currentBattle.infoHeader.update(this.enemyInformation.name+" attacked with "+a.name);window.currentGame.player.looseHealth(a.damage);this.attackHoldBar.resetBar()},getEnemyStats:function(){return Enemies[this.identifier]},looseHealth:function(b){this.enemyInformation.health-=b;if(this.enemyInformation.health<=0){var a=this;this.enemyInformation.health=0;window.currentBattle.endBattle(this.enemyInformation.health,function(){a.rewardPlayer();window.currentBattle.infoHeader.update("You've beaten "+a.enemyInformation.name)})}this.updateHealthBar()},rewardPlayer:function(){var a=this;$.each(["stats","items"],function(b,c){if(a.enemyInformation.rewards[c]){new Rewarder(c,a.enemyInformation.rewards).reward()}})},updateHealthBar:function(){this.healthBar.style.width=this.currentHealth()+"%";this.healthStats.innerHTML=this.enemyInformation.health},currentHealth:function(){return(this.enemyInformation.health/this.startHealth)*100},getGraphic:function(){return this.enemyPre.innerHTML},setGraphicToBattleField:function(){this.enemyPlaceholder=dom.find("#battle-sequence-popup .field .enemy #graphic");this.enemyPlaceholder.innerHTML=this.getGraphic()},setPosition:function(){this.enemyPosition=dom.find("#battle-sequence-popup .field .enemy");this.enemyPosition.style.top=this.enemyInformation.position.y+"px";this.enemyPosition.style.right=this.enemyInformation.position.x+"px"},spawn:function(){this.setPosition();this.setGraphicToBattleField()},unspawn:function(){this.enemyPlaceholder.innerHTML=""}};function Enemy(a,b){this.identifier=a;this.callbacks=b;this.enemyPre=dom.find(".enemies #"+a);this.healthBar=dom.find(".field .enemy .healthbar .health-left");this.healthStats=dom.find(".field .enemy .health-stats .health-stats-left");this.totalHealth=dom.find(".field .enemy .health-stats .total-health");this.enemyInformation=this.getEnemyStats();this.startHealth=this.enemyInformation.health;this.totalHealth.innerHTML=this.startHealth;this.attackHoldBar=new Bar(".field .enemy .attackbar .attack-left",this.enemyInformation.attack_interval);this.attackInterval=null;this.updateHealthBar()}Item.prototype={add:function(){this.addParts();this.removeParts()},addParts:function(){var a=this;$.each(this.item,function(b){a.item[b].style.display="inline";a.item[b].onclick=function(){a.onClickMethod()}})},clearOnClickMethod:function(){var a=this;this.onClickMethod=function(){};$.each(this.item,function(b){a.item[b].style.cursor="default"})},removeParts:function(){var a=this;$.each(this.removals,function(b){a.removals[b].style.display="none"})}};function Item(a,b){this.item=document.getElementsByClassName(a);this.removals=document.getElementsByClassName(a+"-remove");this.onClickMethod=b}Weapon.prototype=Object.create(Item.prototype);Weapon.prototype.add=function(){};function Weapon(a){this.identifier=a}Armor.prototype=Object.create(Item.prototype);Armor.prototype.add=function(){};function Armor(a){this.identifier=a}Rewarder.prototype={reward:function(){var a=this;$.each(this.rewardedItems(),function(b,c){a[a.typeOfReward+"RewardCallback"](c);a.setBattleMessage(c)})},setBattleMessage:function(b){var a=this;a.messageTimeout=setTimeout(function(){window.currentBattle.infoHeader.update(a.rewardMessage(b));clearTimeout(a.messageTimeout)},2000)},rewardMessage:function(b){var a="You get ";a+=this.rewards[b]+" "+b;if(this.rewards[b]>1){a+="s"}return a},statsRewardCallback:function(a){window.currentStats.increaseStat(a,this.rewards[a])},itemsRewardCallback:function(){},rewardedItems:function(){return Object.keys(this.rewards)}};function Rewarder(a,b){this.typeOfReward=a;this.rewards=b[a]}BattleEngine.prototype={addPlayerAttackListeners:function(){this.addMenuButtonOnClickListeners();this.addMenuOnKeyUpListeners();this.battleInterface.classList.remove("disabled")},addMenuButtonOnClickListeners:function(){var a=this;this.attackButton.onclick=function(){window.currentGame.player.attack(a.enemy)};if(!this.skillButton.classList.contains("hide")){this.skillButton.onclick=function(){}}if(!this.magicButton.classList.contains("hide")){this.magicButton.onclick=function(){}}if(!this.itemsButton.classList.contains("disabled")){this.itemsButton.onclick=function(){}}},addMenuOnKeyUpListeners:function(){var a=this;document.onkeydown=function(b){var b=b||window.event;switch(b.keyCode){case 65:window.currentGame.player.attack(a.enemy);break;case 70:window.currentBattle.battlePopup.hide();break;case 73:if(!this.itemsButton.classList.contains("disabled")){}break;case 77:if(!this.magicButton.classList.contains("hide")){}break;case 83:if(!this.skillButton.classList.contains("hide")){}break}}},removePlayerAttackListeners:function(){this.removeMenuButtonOnClickListeners();this.removeMenuOnKeyUpListeners()},removeMenuButtonOnClickListeners:function(){this.attackButton.onclick=null;this.skillButton.onclick=null;this.magicButton.onclick=null;this.itemsButton.onclick=null;this.battleInterface.classList.add("disabled")},removeMenuOnKeyUpListeners:function(){document.onkeydown=null},enable:function(){var a=this;this.battleTimeout=setTimeout(function(){a.addPlayerAttackListeners();clearTimeout(a.battleTimeout)},GameData.player.battle_timeout)},disable:function(){clearTimeout(this.battleTimeout);this.removePlayerAttackListeners();this.enable()},showButtons:function(){if(GameData.player.skills.length<=0){this.skillButton.classList.add("hide")}else{this.skillButton.classList.remove("hide")}if(GameData.player.magic.length<=0){this.magicButton.classList.add("hide")}else{this.magicButton.classList.remove("hide")}if(GameData.player.items.length<=0){this.itemsButton.classList.add("disabled")}else{this.itemsButton.classList.remove("disabled")}}};function BattleEngine(a){this.enemy=a;this.battleInterface=dom.find("#battle-sequence-popup .battle-sequence-interface");this.attackButton=this.battleInterface.querySelector("#attack");this.skillButton=this.battleInterface.querySelector("#skill");this.magicButton=this.battleInterface.querySelector("#magic");this.itemsButton=this.battleInterface.querySelector("#items");this.battleTimeout=null;this.showButtons()}BattleInfoHeader.prototype={update:function(b){var a=this;this.infoHeader.innerHTML=b;move(a.infoHeader).set("opacity",1).duration(0).end(function(){a.messageTimeout=setTimeout(function(){move(a.infoHeader).duration(200).set("opacity",0).end(function(){a.infoHeader.innerHTML=""});clearTimeout(a.messageTimeout)},2000)})},reset:function(){clearTimeout(this.messageTimeout);move(this.infoHeader).set("opacity",1).duration(0).end()}};function BattleInfoHeader(){this.infoHeader=document.getElementById("battle-sequence-info-header")}Battle.prototype={start:function(){this.fillGraphics();this.battlePopup.show();this.battleEngine.enable();this.player.initiateFight();this.enemy.startAttacking();window.currentBattle=this},stopBattle:function(){this.pause();this.emptyGraphics();window.currentBattle=null},pause:function(){this.battleEngine.removePlayerAttackListeners();this.enemy.quitAttacking()},endBattle:function(e,c,b,d){var a=this;this.endingTimeoutTime=d||4000;window.currentBattle.pause();if(c){c()}a.endingTimeout=setTimeout(function(){window.currentBattle.battlePopup.hide();clearTimeout(a.endingTimeout);if(b){b()}},this.endingTimeoutTime)},fillGraphics:function(){this.enemy.spawn();this.player.spawn()},emptyGraphics:function(){this.enemy.unspawn();this.player.unspawn()}};function Battle(a){this.player=window.currentGame.player;this.enemy=a;this.battleEngine=new BattleEngine(this.enemy);this.infoHeader=new BattleInfoHeader();this.battlePopup=new Popup("battle-sequence-popup",undefined,this.stopBattle.bind(this))}BattleInitializer.prototype={start:function(b){var a=new Enemy(b);this.battle=new Battle(a);this.battle.start()}};function BattleInitializer(){}$.domReady(function(){window.BattleInitializer=new BattleInitializer()});ClickArea.prototype={attachClickHandler:function(){this.clickElement.onclick=this.clickAreaMethod.bind(this)},removeClickHandler:function(){this.clickElement.onclick=null},clickAreaMethod:function(){if(this.klass&&this.clickMethod){window[this.klass][this.clickMethod].apply(null,this.args)}else{function a(){}}},enable:function(){this.clickElement.classList.remove("disabled");this.attachClickHandler()},disable:function(){this.clickElement.classList.add("disabled");this.removeClickHandler()}};function ClickArea(d,a,c,b){this.identifier=d;this.klass=a;this.clickMethod=c||function(){};this.args=b;this.clickElement=document.getElementById(d);this.attachClickHandler()}Level.prototype={addToGame:function(){this.unsetCurrentGame();this.setCurrentGame()},setCurrentGame:function(){this.showMap();this.setClickAreas();window.currentGame.gameMap.disableMapSpot(this.mapSpot);window.currentLevel=this},unsetCurrentGame:function(){if(window.currentLevel){window.currentLevel.hideMap();window.currentLevel.removeClickAreas();window.currentLevel.pointOnMap.innerHTML="O";window.currentGame.gameMap.enableMapSpot(window.currentLevel.mapSpot);window.currentLevel=null}},showMap:function(){this.levelDom.style.display="block"},hideMap:function(){this.levelDom.style.display="none"},removeClickAreas:function(){this.levelClickAreas={}},setClickAreas:function(){var a=this;$.each(window.clickAreas[this.identifier],function(b,c){var d=new ClickArea(c.id,c.klass,c.method,c.args);a.levelClickAreas[c.id]=d})},setMapSpot:function(){var a=this.mapSpot?this.mapSpot:this.identifier;return dom.find("#map-popup #"+a)},levelClickAreas:{}};function Level(a,b){this.identifier=a;this.mapSpot=b||a;this.levelDom=dom.find("#game-levels #"+a);this.pointOnMap=this.setMapSpot()}Game.prototype={initialize:function(){if(GameStorage.canStore()){GameData.settings.autoSaveEnabled=true;this.gid=GameStorage.get("koo-koo-island-gid")||$.guid();this.player=new Player();this.gameMap=new GameMap();this.setLevels();this.setCallbacks();this.storeGid();this.getOldGameData();this.toggleAutoSaveInterval()}else{}},setLevels:function(){this.levels={};this.levels.island=new Level("island");this.levels.squirrel_city=new Level("squirrel_city");this.levels.squirrel_city_first_level=new Level("squirrel_city_first_level_house","squirrel_city");this.levels.squirrel_city_second_level=new Level("squirrel_city_second_level_house","squirrel_city");this.levels.squirrel_city_attic_level=new Level("squirrel_city_attic_level_house","squirrel_city");this.levels.island.addToGame()},setCallbacks:function(){this.callbacks={};this.callbacks.loadCallbacks=LoadCallbacks;this.callbacks.experienceCallbacks=ExperienceCallbacks;this.callbacks.statsCallbacks=StatsCallbacks;if(ENV=="production"){delete LoadCallbacks,ExperienceCallbacks,StatsCallbacks}},toggleAutoSaveInterval:function(){var a=this;if(GameData.settings.autoSaveEnabled){this.autoSaveInterval=setInterval(function(){a.save()},this.autoSaveTimeInterval)}else{clearInterval(this.autoSaveInterval)}},save:function(){new Flash("saved").show();GameStorage.store(this.gid,btoa(JSON.stringify(GameData)))},storeGid:function(){if(!GameStorage.keyExists("koo-koo-island-gid")){GameStorage.store("koo-koo-island-gid",this.gid)}},loadGame:function(b,a){GameStorage.store(b,a);GameData=JSON.parse(atob(GameStorage.get(b)))},getOldGameData:function(){if(ENV=="production"){window.GameData=JSON.parse(atob(GameStorage.get(this.gid)))||{}}this.toggleLoadCallbacks()},toggleLoadCallbacks:function(){var a=this;$.each(Object.keys(window.GameData.progress),function(c,b){if(a.checkProgressOn(b)){a.callbacks.loadCallbacks[b]()}});$.each(["wood","seashell","wood"],function(b,c){if(window.GameData.player[c+"s"]>0){a.callbacks.loadCallbacks.show_stat(c)}});if(a.player.inventory.hasSomethingInInventory()){a.callbacks.loadCallbacks.setup_inventory()}},toggleAutoSave:function(){GameData.settings.autoSaveEnabled=!GameData.settings.autoSaveEnabled;this.toggleAutoSaveInterval()},checkProgressOn:function(a){return GameData.progress[a]==1},autoSaveInterval:null,autoSaveTimeInterval:5000};function Game(){}function initializeAutoSaveButton(){var a=document.getElementById("auto-save");changeAutoSaveButtonText(a);a.onclick=function(){window.currentGame.toggleAutoSave();changeAutoSaveButtonText(a)}}function initializeLoadButton(){var a=document.getElementById("laad")}function changeAutoSaveButtonText(a){a.innerHTML=getAutoSaveText()}function getAutoSaveText(){if(GameData.settings.autoSaveEnabled){return"Auto save: on"}else{return"Auto save: off"}}function initializeSaveButton(){var a=document.getElementById("save");a.onclick=function(){window.currentGame.save()}}$.domReady(function(){window.currentGame=new Game();window.currentGame.initialize();window.currentStats=new Stats();initializeAutoSaveButton();initializeSaveButton();initializeLoadButton()});
