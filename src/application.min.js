/*! JSON v3.3.2 | http://bestiejs.github.io/json3 | Copyright 2012-2014, Kit Cambridge | http://kit.mit-license.org */
(function(){function d(ax,at){function av(x){if(av[x]!==aj){return av[x]}var v;if("bug-string-char-index"==x){v="a"!="a"[0]}else{if("json"==x){v=av("json-stringify")&&av("json-parse")}else{var t;if("json-stringify"==x){v=at.stringify;var w="function"==typeof v&&aq;if(w){(t=function(){return 1}).toJSON=t;try{w="0"===v(0)&&"0"===v(new ao)&&'""'==v(new aw)&&v(am)===aj&&v(aj)===aj&&v()===aj&&"1"===v(t)&&"[1]"==v([t])&&"[null]"==v([aj])&&"null"==v(null)&&"[null,null,null]"==v([aj,am,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==v({a:[t,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===v(null,t)&&"[\n 1,\n 2\n]"==v([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==v(new ar(-8640000000000000))&&'"+275760-09-13T00:00:00.000Z"'==v(new ar(8640000000000000))&&'"-000001-01-01T00:00:00.000Z"'==v(new ar(-62198755200000))&&'"1969-12-31T23:59:59.999Z"'==v(new ar(-1))}catch(s){w=!1}}v=w}if("json-parse"==x){v=at.parse;if("function"==typeof v){try{if(0===v("0")&&!v(!1)){t=v('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var p=5==t.a.length&&1===t.a[0];if(p){try{p=!v('"\t"')}catch(u){}if(p){try{p=1!==v("01")}catch(r){}}if(p){try{p=1!==v("1.")}catch(q){}}}}}catch(l){p=!1}}v=p}}}return av[x]=!!v}ax||(ax=b.Object());at||(at=b.Object());var ao=ax.Number||b.Number,aw=ax.String||b.String,ai=ax.Object||b.Object,ar=ax.Date||b.Date,ak=ax.SyntaxError||b.SyntaxError,ad=ax.TypeError||b.TypeError,ab=ax.Math||b.Math,ah=ax.JSON||b.JSON;"object"==typeof ah&&ah&&(at.stringify=ah.stringify,at.parse=ah.parse);var ai=ai.prototype,am=ai.toString,al,au,aj,aq=new ar(-3509827334573292);try{aq=-109252==aq.getUTCFullYear()&&0===aq.getUTCMonth()&&1===aq.getUTCDate()&&10==aq.getUTCHours()&&37==aq.getUTCMinutes()&&6==aq.getUTCSeconds()&&708==aq.getUTCMilliseconds()}catch(X){}if(!av("json")){var ap=av("bug-string-char-index");if(!aq){var ag=ab.floor,aa=[0,31,59,90,120,151,181,212,243,273,304,334],an=function(l,p){return aa[p]+365*(l-1970)+ag((l-1969+(p=+(1<p)))/4)-ag((l-1901+p)/100)+ag((l-1601+p)/400)}}(al=ai.hasOwnProperty)||(al=function(l){var q={},p;(q.__proto__=null,q.__proto__={toString:1},q).toString!=am?al=function(r){var s=this.__proto__;r=r in (this.__proto__=null,this);this.__proto__=s;return r}:(p=q.constructor,al=function(r){var s=(this.constructor||p).prototype;return r in this&&!(r in s&&this[r]===s[r])});q=null;return al.call(this,l)});au=function(p,t){var r=0,l,q,s;(l=function(){this.valueOf=0}).prototype.valueOf=0;q=new l;for(s in q){al.call(q,s)&&r++}l=q=null;r?au=2==r?function(v,y){var x={},u="[object Function]"==am.call(v),w;for(w in v){u&&"prototype"==w||al.call(x,w)||!(x[w]=1)||!al.call(v,w)||y(w)}}:function(v,y){var x="[object Function]"==am.call(v),u,w;for(u in v){x&&"prototype"==u||!al.call(v,u)||(w="constructor"===u)||y(u)}(w||al.call(v,u="constructor"))&&y(u)}:(q="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),au=function(v,y){var x="[object Function]"==am.call(v),u,w=!x&&"function"!=typeof v.constructor&&i[typeof v.hasOwnProperty]&&v.hasOwnProperty||al;for(u in v){x&&"prototype"==u||!w.call(v,u)||y(u)}for(x=q.length;u=q[--x];w.call(v,u)&&y(u)){}});return au(p,t)};if(!av("json-stringify")){var n={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},af=function(l,p){return("000000"+(p||0)).slice(-l)},N=function(p){for(var u='"',l=0,q=p.length,r=!ap||10<q,t=r&&(ap?p.split(""):p);l<q;l++){var s=p.charCodeAt(l);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:u+=n[s];break;default:if(32>s){u+="\\u00"+af(2,s.toString(16));break}u+=r?t[l]:p.charAt(l)}}return u+'"'},Z=function(K,I,J,C,E,x,G){var D,y,B,A,w,u,M,L,v;try{D=I[K]}catch(H){}if("object"==typeof D&&D){if(y=am.call(D),"[object Date]"!=y||al.call(D,"toJSON")){"function"==typeof D.toJSON&&("[object Number]"!=y&&"[object String]"!=y&&"[object Array]"!=y||al.call(D,"toJSON"))&&(D=D.toJSON(K))}else{if(D>-1/0&&D<1/0){if(an){A=ag(D/86400000);for(y=ag(A/365.2425)+1970-1;an(y+1,0)<=A;y++){}for(B=ag((A-an(y,0))/30.42);an(y,B+1)<=A;B++){}A=1+A-an(y,B);w=(D%86400000+86400000)%86400000;u=ag(w/3600000)%24;M=ag(w/60000)%60;L=ag(w/1000)%60;w%=1000}else{y=D.getUTCFullYear(),B=D.getUTCMonth(),A=D.getUTCDate(),u=D.getUTCHours(),M=D.getUTCMinutes(),L=D.getUTCSeconds(),w=D.getUTCMilliseconds()}D=(0>=y||10000<=y?(0>y?"-":"+")+af(6,0>y?-y:y):af(4,y))+"-"+af(2,B+1)+"-"+af(2,A)+"T"+af(2,u)+":"+af(2,M)+":"+af(2,L)+"."+af(3,w)+"Z"}else{D=null}}}J&&(D=J.call(I,K,D));if(null===D){return"null"}y=am.call(D);if("[object Boolean]"==y){return""+D}if("[object Number]"==y){return D>-1/0&&D<1/0?""+D:"null"}if("[object String]"==y){return N(""+D)}if("object"==typeof D){for(K=G.length;K--;){if(G[K]===D){throw ad()}}G.push(D);v=[];I=x;x+=E;if("[object Array]"==y){B=0;for(K=D.length;B<K;B++){y=Z(B,D,J,C,E,x,G),v.push(y===aj?"null":y)}K=v.length?E?"[\n"+x+v.join(",\n"+x)+"\n"+I+"]":"["+v.join(",")+"]":"[]"}else{au(C||D,function(l){var p=Z(l,D,J,C,E,x,G);p!==aj&&v.push(N(l)+":"+(E?" ":"")+p)}),K=v.length?E?"{\n"+x+v.join(",\n"+x)+"\n"+I+"}":"{"+v.join(",")+"}":"{}"}G.pop();return K}};at.stringify=function(y,w,x){var s,u,p,v;if(i[typeof w]&&w){if("[object Function]"==(v=am.call(w))){u=w}else{if("[object Array]"==v){p={};for(var t=0,r=w.length,q;t<r;q=w[t++],(v=am.call(q),"[object String]"==v||"[object Number]"==v)&&(p[q]=1)){}}}}if(x){if("[object Number]"==(v=am.call(x))){if(0<(x-=x%1)){for(s="",10<x&&(x=10);s.length<x;s+=" "){}}}else{"[object String]"==v&&(s=10>=x.length?x:x.slice(0,10))}}return Z("",(q={},q[""]=y,q),u,p,s,"",[])}}if(!av("json-parse")){var m=aw.fromCharCode,k={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},az,ae,ay=function(){az=ae=null;throw ak()},ac=function(){for(var l=ae,u=l.length,s,q,r,p,t;az<u;){switch(t=l.charCodeAt(az),t){case 9:case 10:case 13:case 32:az++;break;case 123:case 125:case 91:case 93:case 58:case 44:return s=ap?l.charAt(az):l[az],az++,s;case 34:s="@";for(az++;az<u;){if(t=l.charCodeAt(az),32>t){ay()}else{if(92==t){switch(t=l.charCodeAt(++az),t){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:s+=k[t];az++;break;case 117:q=++az;for(r=az+4;az<r;az++){t=l.charCodeAt(az),48<=t&&57>=t||97<=t&&102>=t||65<=t&&70>=t||ay()}s+=m("0x"+l.slice(q,az));break;default:ay()}}else{if(34==t){break}t=l.charCodeAt(az);for(q=az;32<=t&&92!=t&&34!=t;){t=l.charCodeAt(++az)}s+=l.slice(q,az)}}}if(34==l.charCodeAt(az)){return az++,s}ay();default:q=az;45==t&&(p=!0,t=l.charCodeAt(++az));if(48<=t&&57>=t){for(48==t&&(t=l.charCodeAt(az+1),48<=t&&57>=t)&&ay();az<u&&(t=l.charCodeAt(az),48<=t&&57>=t);az++){}if(46==l.charCodeAt(az)){for(r=++az;r<u&&(t=l.charCodeAt(r),48<=t&&57>=t);r++){}r==az&&ay();az=r}t=l.charCodeAt(az);if(101==t||69==t){t=l.charCodeAt(++az);43!=t&&45!=t||az++;for(r=az;r<u&&(t=l.charCodeAt(r),48<=t&&57>=t);r++){}r==az&&ay();az=r}return +l.slice(q,az)}p&&ay();if("true"==l.slice(az,az+4)){return az+=4,!0}if("false"==l.slice(az,az+5)){return az+=5,!1}if("null"==l.slice(az,az+4)){return az+=4,null}ay()}}return"$"},Y=function(p){var q,l;"$"==p&&ay();if("string"==typeof p){if("@"==(ap?p.charAt(0):p[0])){return p.slice(1)}if("["==p){for(q=[];;l||(l=!0)){p=ac();if("]"==p){break}l&&(","==p?(p=ac(),"]"==p&&ay()):ay());","==p&&ay();q.push(Y(p))}return q}if("{"==p){for(q={};;l||(l=!0)){p=ac();if("}"==p){break}l&&(","==p?(p=ac(),"}"==p&&ay()):ay());","!=p&&"string"==typeof p&&"@"==(ap?p.charAt(0):p[0])&&":"==ac()||ay();q[p.slice(1)]=Y(ac())}return q}ay()}return p},o=function(p,l,q){q=F(p,l,q);q===aj?delete p[l]:p[l]=q},F=function(p,l,s){var q=p[l],r;if("object"==typeof q&&q){if("[object Array]"==am.call(q)){for(r=q.length;r--;){o(q,r,s)}}else{au(q,function(t){o(q,t,s)})}}return s.call(p,l,q)};at.parse=function(l,r){var q,p;az=0;ae=""+l;q=Y(ac());"$"!=ac()&&ay();az=ae=null;return r&&"[object Function]"==am.call(r)?F((p={},p[""]=q,p),"",r):q}}}at.runInContext=d;return at}var g=typeof define==="function"&&define.amd,i={"function":!0,object:!0},h=i[typeof exports]&&exports&&!exports.nodeType&&exports,b=i[typeof window]&&window||this,j=h&&i[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;!j||j.global!==j&&j.window!==j&&j.self!==j||(b=j);if(h&&!g){d(b,h)}else{var f=b.JSON,c=b.JSON3,e=!1,a=d(b,b.JSON3={noConflict:function(){e||(e=!0,b.JSON=f,b.JSON3=c,f=c=null);return a}});b.JSON={parse:a.parse,stringify:a.stringify}}g&&define(function(){return a})}).call(this);$={isBrowserCompatible:function(){return window.localStorage!==null&&Array.prototype.map&&Array.prototype.filter&&document.querySelector&&document.querySelectorAll&&window.btoa&&window.atob},domReady:function(a){if(document.addEventListener){document.addEventListener("DOMContentLoaded",a)}else{document.attachEvent("onreadystatechange",function(){if(document.readyState==="interactive"){a()}})}},each:function(c,b){for(var a=0;a<c.length;a++){b(a,c[a])}},guid:function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)},titleize:function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()},methodize:function(b){var a=b.split(/\-|\_/).map(function(c){return $.titleize(c)});return a.join("").replace(/\#|\./,"")},constantize:function(b){var a=b.replace(/\#|\./,"").split(/\-|\_/).map(function(c){return $.titleize(c)});return a.join("")},setSelectBoxSelected:function(a,b){$.each(a.querySelectorAll("option"),function(c,d){d.selected=false});a.querySelector("option[value="+b+"]").selected=true},freeze:function(b){var c,a;Object.freeze(b);for(a in b){c=b[a];if(!b.hasOwnProperty(a)||!(typeof c==="object")||Object.isFrozen(c)){continue}$.freeze(c)}}};dom={find:function(a,b){if(b){return document.querySelectorAll(a)}else{return document.querySelector(a)}},findId:function(a){return document.getElementById(a)},findClass:function(a){return document.getElementsByClassName(a)}};GameStorage={store:function(a,b){return localStorage.setItem(a,b)},get:function(a){return localStorage.getItem(a)},keyExists:function(a){return localStorage.getItem(a)!==null}};Flash.prototype={show:function(){var a=this;this.message.style.display="block";var b=setTimeout(function(){a.message.style.display="none";clearTimeout(b)},this.time)}};function Flash(a,b){this.message=dom.findId(a);this.time=b||2000}Popup.prototype={show:function(){this.popup.style.display="block";this.openCallback()},hide:function(){this.popup.style.display="none";this.closeCallback()},addCloseListener:function(){var a=this;this.closeButton.onclick=function(){a.hide()}}};function Popup(b,a,c){this.popup=dom.findId(b);this.closeButton=dom.findId(b+"-close");this.openCallback=a||function(){};this.closeCallback=c||function(){};this.addCloseListener()}Bar.prototype={show:function(){this.domBar.style.opacity="1"},hide:function(){this.domBar.style.opacity="0"},fillBar:function(){move(this.bar).set("width","100%").ease("in").duration(this.interval).end(this.callback)},resetBar:function(a){move(this.bar).duration(0).set("width","0px").end();this.setCallback(a);this.fillBar()},setCallback:function(a){this.callback=a||(function(){})}};function Bar(b,a){this.bar=b;this.domBar=dom.find(b).parentNode;this.interval=a;this.fillBarCallback}StatBar.prototype={update:function(a){this.currentStatAmount=a;this.currentAmount.innerHTML=a;this.innerBar.style.width=this.calculatePercentage()+"%"},set:function(a,b){this.currentStatAmount=a;this.totalStatAmount=b;this.currentAmount.innerHTML=a;this.total.innerHTML=b;this.update(a)},calculatePercentage:function(){return(this.currentStatAmount/this.totalStatAmount)*100}};function StatBar(c,b,d,a){this.barScope=dom.find(c);this.currentAmount=this.barScope.querySelector(b);this.total=this.barScope.querySelector(d);this.innerBar=this.barScope.querySelector(a)}window.LonelyIsland={addShark:function(){GameData.progress.show_shark=1;$.each(document.querySelectorAll("span.big-shark-part"),function(a,b){b.style.display="inline-block"})},removeShark:function(){$.each(document.querySelectorAll("span.big-shark-part"),function(a,b){b.style.display="none"})},showMessageInABottle:function(){GameData.progress.show_bottle=1;var a=new InventoryItem("map","items");window.currentGame.messageInABottle=new Item("message-in-a-bottle",function(){var b=new Popup("message-in-a-bottle-popup",undefined,function(){window.currentGame.messageInABottle.clearOnClickMethod();dom.find(".message-in-a-bottle .message").innerHTML="&nbsp;";window.currentGame.player.inventory.addItem("items",a)});b.show()});window.currentGame.messageInABottle.add()},showFish:function(){GameData.progress.show_fish=1;var a=new Character("fish",{initialize:function(){var b=this;var c=dom.findId("fish-seller-buy-button");this.itemsForSale=document.querySelectorAll(".sell-items li");this.initialfishSellerPopUp=new Popup("fish-seller-popup");this.fishBuyPopUp=new Popup("fish-seller-buy-popup",function(){b.checkFishInventory()},function(){b.initialfishSellerPopUp.hide()});c.onclick=function(){b.fishBuyPopUp.show()};this.addBuyListeners()},click:function(){this.initialfishSellerPopUp.show()},checkFishInventory:function(){$.each(this.itemsForSale,function(b,c){var d=c.getAttribute("name");if(window.currentGame.player.canBuyItem(d)){c.classList.remove("disabled")}else{c.classList.add("disabled")}})},addBuyListeners:function(){var b=this;$.each(this.itemsForSale,function(c,d){d.onclick=function(){var e=d.getAttribute("name");window.currentGame.player.buy(e);b.checkFishInventory()}})}});a.add()},showBuildBridgeButton:function(){var b=new Popup("island-bridge-popup",window.LonelyIsland.enableBuildBridgeButton);var a=dom.findId("island-bridge");a.classList.remove("disabled");a.onclick=function(){b.show()}},enableBuildBridgeButton:function(){if(GameData.player.woods>=100&&!window.currentGame.checkProgressOn("enable_build_bridge_button")&&window.currentGame.checkProgressOn("show_bottle")){var a=dom.find("#island-bridge-popup #build-island-bridge");GameData.progress.enable_build_bridge_button=1;a.removeAttribute("disabled");a.onclick=function(){window.currentStats.increaseStat("wood",-100);window.currentGame.gameMap.showBridge();window.currentGame.gameMap.enableMapSpot("squirrel_city");a.setAttribute("disabled","disabled");a.onclick=null}}},disableSeashell:function(){GameData.progress.hide_seashell=1;var a=dom.find("#game-levels #lonely_island #island-seashell");a.classList.add("disabled");a.innerHTML="&nbsp;";window.currentGame.levels.lonely_island.setClickMethodsToLevel();window.LonelyIsland.enableWhirlpool()},enableWhirlpool:function(){var a=dom.find("#game-levels #lonely_island #island-whirlpool");a.style.display="inline"}};window.UnderwaterShack={FISHES:[{name:"tiny-fish",probability:5},{name:"tiny-fish-with-gun",probability:2},{name:"big-fish",probability:1}],initialize:function(){var a=dom.find("#island-whirlpool-2");a.onclick=function(){window.currentGame.levels.lonely_island.addToGame.bind(window.currentGame.levels.lonely_island)()};this.spawnFish()},spawnFish:function(){var a=this;this.fishSpawnInterval=setInterval(function(){if(a.fishCount()<=5){var b=a.buildFish();dom.findId("underwater_shack").appendChild(b);window.Animations.FishSpawner.spawn(b)}},this.calculateIntervalNumber())},buildFish:function(){var a=this.pickFish().name;var b=dom.find(".enemies #"+a).cloneNode(true);b.className="us-fish";b.id="fish-"+this.fishCount();b.style.top=(Math.round(Math.random()*370)+90)+"px";b.onclick=window.BattleInitializer.start.bind(this,("btl-"+a),null,this.spawnFish.bind(this));return b},pickFish:function(){var c=[];for(var b=0;b<this.FISHES.length;b++){for(var a=0;a<this.FISHES[b].probability;a++){c.push(this.FISHES[b])}}picked_fish=Math.round(Math.random()*(c.length-1));return c[picked_fish]},fishCount:function(){return dom.find(".us-fish",true).length},calculateIntervalNumber:function(){return Math.round(Math.random()*7000)+1000},destroyFish:function(){$.each(dom.find(".us-fish",true),function(b,a){a.remove()})},destroy:function(){clearInterval(this.fishSpawnInterval);this.destroyFish()}};window.SquirrelCity={initialize:function(){this.squirrelPopUp=new Popup("squirrel-city-mysterious-squirrel")},talkToSquirrel:function(){this.squirrelPopUp.show()},openDoor:function(){var a=dom.find("#squirrel-warning button#enter-the-house");var b=new Popup("squirrel-warning");b.show();a.onclick=function(){window.currentGame.levels.squirrel_city_first_level_house.addToGame();b.hide()}},goToFirstLevel:function(){window.currentGame.levels.squirrel_city_second_level_house.addToGame()},goToSecondLevel:function(){window.currentGame.levels.squirrel_city_attic_level_house.addToGame()},goToGroundLevel:function(){window.currentGame.levels.squirrel_city_first_level_house.addToGame()},goOutside:function(){window.currentGame.levels.squirrel_city.addToGame()},grabSpear:function(){if(!window.currentGame.checkProgressOn("squirrel_house_spear")){GameData.progress.squirrel_house_spear=1;var a=new Weapon("spear");window.currentGame.player.inventory.addItem("weapons",a);window.SquirrelCity.disableSpear()}},disableSpear:function(){$.each(document.querySelectorAll(".squirrel-city-spear-wall"),function(a,b){b.innerHTML="&nbsp;";b.classList.add("disabled");b.onclick=null})},destroy:function(){delete this.squirrelPopUp}};window.ExperiencePoints={"9":{hp:10},"19":{hp:20},"49":{hp:20,mp:20},"99":{speed:500},"149":{hp:20},"199":{hp:20,mp:20},"249":{hp:20},"299":{hp:20},"349":{hp:20,mp:50},"399":{hp:20},"449":{hp:20},"499":{hp:20,mp:50},"549":{hp:20},"599":{hp:20},"649":{hp:20,mp:50},"699":{hp:20},"749":{hp:20},"799":{hp:20,mp:100},"849":{hp:20},"899":{hp:20},"949":{hp:20,mp:100},"999":{hp:20},"1249":{hp:20},"1499":{hp:20,mp:200},"1749":{hp:20}};$.freeze(window.ExperiencePoints);var ExperienceCallbacks=(function(){ExperienceCallbacks={increaseExperience:function(e){GameData.player.experience+=e;b()}};function b(){$.each(c(),function(e,f){if(GameData.player.experience>parseInt(f)&&GameData.player.experience_rewards.indexOf(f)===-1){a(f)}})}function c(){return Object.keys(ExperiencePoints).filter(function(e){return parseInt(e)<=GameData.player.experience})}function a(g){GameData.player.experience_rewards.push(g);var e=ExperiencePoints[g];for(var f in e){window.currentBattle.eventEngine.add({perform:d[f](e[f]),message:"You leveled up!",timeOut:2000})}}var d={hp:function(e){GameData.player.hp[1]+=e},mp:function(e){GameData.player.mp[1]+=e},speed:function(e){GameData.player.battle_timeout+=e}};return ExperienceCallbacks})();StatsCallbacks={seashell:{performCallback:function(a){if(a>0&&!window.currentGame.checkProgressOn("show_fish")){window.LonelyIsland.showFish()}else{if(a>19&&!window.currentGame.checkProgressOn("show_bottle")){window.LonelyIsland.showMessageInABottle()}else{if(a>199&&!window.currentGame.checkProgressOn("hide_seashell")){window.LonelyIsland.disableSeashell()}else{if(a>999&&!window.currentGame.checkProgressOn("show_shark")){window.LonelyIsland.addShark()}}}}}},oyster:{performCallback:function(a){}},wood:{performCallback:function(a){if(a>0&&!window.currentGame.checkProgressOn("show_build_bridge_button")){window.LonelyIsland.showBuildBridgeButton()}}}};var LoadCallbacks=(function(){LoadCallbacks={show_fish:function(){window.LonelyIsland.showFish()},show_bottle:function(){window.LonelyIsland.showMessageInABottle()},show_shark:function(){window.LonelyIsland.addShark()},show_build_bridge_button:function(){window.LonelyIsland.showBuildBridgeButton()},hide_seashell:function(){window.LonelyIsland.disableSeashell()},beaten_shark:function(){window.LonelyIsland.removeShark()},squirrel_house_spear:function(){window.SquirrelCity.disableSpear()},squirrel_house_small_painting:function(){},squirrel_house_closet:function(){},squirrel_house_boss_fight:function(){window.currentGame.gameMap.enableMapSpot("cliffhill_town");window.currentGame.gameMap.enableMapSpot("forest_of_protectors")},squirrel_house_chimney:function(){dom.findId("add-magical-fire-spell").innerHTML="_";dom.findId("add-magical-fire-spell").classList.add("disabled")},show_stat:function(a){var c=dom.findId(a+"s");var b=dom.findId(a+"-count");c.style.display="inline-block";b.innerHTML=GameData.player[a+"s"]},setupInventory:function(){window.currentGame.player.inventory.checkInventory();for(var a in window.GameData.player.inventory){$.each(window.GameData.player.inventory[a],function(b,c){if(window.currentGame.callbacks.loadCallbacks.inventory[c+"_callback"]){window.currentGame.callbacks.loadCallbacks.inventory[c+"_callback"]()}new InventoryItem(c,a).add()})}},setupPlayer:function(){window.currentGame.player.loadCurrentArmor();window.currentGame.player.loadCurrentWeapon()},enable_build_bridge_button:function(){window.currentGame.gameMap.showBridge();window.currentGame.gameMap.enableMapSpot("squirrel_city")},inventory:{map_callback:function(){window.currentGame.messageInABottle.clearOnClickMethod();dom.find(".message-in-a-bottle .message").innerHTML="&nbsp;"}}};return LoadCallbacks})();Character.prototype={add:function(){this.character.style.display="inline";this.toBeRemovedSpan.style.display="none";this.applyOtherMethods();this.addOnClickMethod();this.addOnInitializeMethod()},addOnClickMethod:function(){if(this.methods&&this.methods.click){this.character.onclick=this.methods.click.bind(this)}},addOnInitializeMethod:function(){if(this.methods&&this.methods.initialize){this.methods.initialize.bind(this)()}},applyOtherMethods:function(){for(method in this.methods){if(!/click|initialize/.test(method)){this[method]=this.methods[method]}}}};function Character(b,a){this.character=dom.findId(b);this.characterType=this.character.className;this.toBeRemovedSpan=dom.findId(b+"-remove");this.methods=a}window.ClickAreas={lonely_island:["#island-seashell","#island-bridge","#battle-big-shark","#island-whirlpool"],underwater_shack:["#island-whirlpool"],squirrel_city:["#mysterious-squirrel","#haunted-house-door"],squirrel_city_first_level_house:[".door-squirrel-city-house","#squirrel-city-goto-first-level"],squirrel_city_second_level_house:["#squirrel-city-goto-second-level","#squirrel-city-goto-ground-level",".squirrel-city-spear-wall",".squirrel-house-closet"],squirrel_city_attic_level_house:["#squirrel-city-goto-first-level-back","#add-magical-fire-spell"]};$.freeze(window.ClickAreas);var ENV="development";var GameData={settings:{},player:{hp:[20,20],mp:[20,20],experience:0,attack_damage:90,battle_timeout:5000,seashells:199,oysters:0,woods:100,armor:"clown",weapon:"spear",map:2,inventory:{weapons:["spear"],armors:["clown"],skills:[],magic:["fire"],items:["map","potion","ether"]},experience_rewards:["9","19","49"],last_visited:"lonely_island"},progress:{show_fish:1,show_bottle:1,show_shark:1,show_build_bridge_button:1,enable_build_bridge_button:1,hide_seashell:1,beaten_shark:0,squirrel_house_spear:1,squirrel_house_small_painting:0,squirrel_house_closet:0,squirrel_house_boss_fight:1,squirrel_house_chimney:1}};window.sellPrices={oyster:{value:10,type:"seashells"},wood:{value:20,type:"seashells"}};$.freeze(window.sellPrices);window.Enemies={"big-shark":{name:"Shark",health:9999,attack_interval:7500,attacks:{bite:{name:"bite",damage:1000,probability:20},laser:{name:"laser",damage:9999,probability:1}},player_position:{x:460,y:-85},position:{x:0,y:0},rewards:{experience:{amount:1000},stats:{seashell:150,oyster:20},items:{weapon:"shark_laser"}},endingCallback:function(){GameData.progress.beaten_shark=1;window.LonelyIsland.removeShark()}},"btl-tiny-fish":{name:"Tiny Fish",health:10,attack_interval:7500,attacks:{bite:{name:"bite",damage:1,probability:1}},player_position:{x:660,y:-50},position:{x:41,y:160},rewards:{experience:{amount:1},stats:{seashell:2,wood:1}}},"btl-tiny-fish-with-gun":{name:"Tiny Fish With Gun",health:20,attack_interval:7500,attacks:{bite:{name:"bite",damage:1,probability:3},shoot:{name:"shoot",damage:5,probability:1}},player_position:{x:660,y:-50},position:{x:41,y:160},rewards:{experience:{amount:1},stats:{seashell:2,wood:5}}},"btl-big-fish":{name:"Big Fish",health:50,attack_interval:10500,attacks:{bite:{name:"bite",damage:1,probability:3},stomp:{name:"stomp",damage:10,probability:1}},player_position:{x:660,y:-60},position:{x:41,y:90},rewards:{experience:{amount:2},stats:{seashell:5,wood:10}}},"evil-portrait":{name:"Evil Portrait",health:100,attack_interval:7500,attacks:{paint:{name:"paint",damage:5,probability:5},water:{name:"water",damage:10,probability:1},smear:{name:"smear",damage:1,probability:1}},player_position:{x:680,y:-105},position:{x:0,y:40},rewards:{experience:{amount:50},stats:{seashell:150,oyster:20},items:{map:2}},endingCallback:function(){GameData.progress.squirrel_house_boss_fight=1}}};window.Weapons={shark_laser:{title:"Shark Laser",description:"Heavy shark laser",damage:5,graphic:["H","Y"],large_graphic:["               ","       H       ","       H       ","       H       ","       Y       ","     //|\\\\     ","       ^       ","       ^       ","       |       "]},spear:{title:"Spear",description:"Basic spear",damage:1.2,graphic:["^","|"],large_graphic:["               ","       ^       ","       ^       ","       |       ","       |       ","       |       ","      /|       ","       ^       ","       |       "]},none:{title:"",description:"",damage:1,graphic:["",""],large_graphic:["               ","               ","               ","               ","               ","               ","               ","               ","               "]}};$.freeze(window.Weapons);window.Armors={clown:{title:"Clown armor",description:"Clown armor - reduces 20% of damage",damage_reduction:0.2,graphic:["<0> ","/[*]\\"," / \\"],large_graphic:["      { }      ","      /*\\      ","     /_*_\\     ","    <('.')>    ","    /[>.<]\\    ","   C [___] D   ","    /  Y  \\    ","   _\\__|__/_   ","  (___/ \\___)  "]},none:{title:"",description:"",damage_reduction:0,graphic:["o ","/|\\","/ \\"],large_graphic:["               ","               ","               ","               ","               ","               ","               ","               ","               "]}};$.freeze(window.Armors);window.Items={remove:function(b){dom.find("#inventory-stash .items #"+b).remove();if(window.currentBattle){dom.find(".battle-sequence-interface .items #"+b).remove()}var a=GameData.player.inventory.items.indexOf(b);GameData.player.inventory.items.splice(a,1)},potion:{title:"Potion",description:"Restores 25 hp",use:function(){window.Items.remove("potion");window.currentGame.player.increaseHealth(25)}},hiPotion:{title:"Hi-Potion",description:"Restores 100 hp",use:function(){window.Items.remove("hiPotion");window.currentGame.player.increaseHealth(100)}},ether:{title:"Ether",description:"Restores 15 mp",use:function(){window.Items.remove("ether");window.currentGame.player.increaseMagic(15)}},hiEther:{title:"Hi-Ether",description:"Restores 50 mp",use:function(){window.Items.remove("hiEther");window.currentGame.player.increaseMagic(50)}},elixer:{title:"Elixer",description:"Restores full hp and mp",use:function(){window.Items.remove("elixer");window.currentGame.player.increaseHealth(GameData.player.hp[1]);window.currentGame.player.increaseMagic(GameData.player.mp[1])}},map:{title:"A partial map of the world",description:"A partial map of the world",use:function(){window.currentGame.gameMap.popUp.show()}}};$.freeze(window.Items);Stats.prototype={increaseStat:function(c,a){var b=dom.findId(c+"s");var d=dom.findId(c+"-count");b.style.display="inline-block";window.currentStats.add(c+"s",a);if(window.currentGame.callbacks.statsCallbacks[c].performCallback){window.currentGame.callbacks.statsCallbacks[c].performCallback(GameData.player[c+"s"])}d.innerHTML=GameData.player[c+"s"]},add:function(b,a){GameData.player[b]+=a}};function Stats(){}Graphic.prototype={addChild:function(c){var b=dom.findId("game-level");var a=document.createElement("PRE");a.innerHTML=this.asciiString;b.appendChild(a)}};function Graphic(a){this.asciiString=a.join("\n")}Inventory.prototype={getInventory:function(){return GameData.player.inventory},hasSomethingInInventory:function(){var a=this.getInventory();return(a.items.length>0||a.weapons.length>0||a.armors.length>0||a.magic.length>0||a.skills.length>0)},checkInventory:function(){if(GameData.player.inventory.items.length>0){this.setupInventoryButton()}if(GameData.player.mp[1]>0){this.inventoryDom.querySelector("#magic").classList.remove("disabled");this.inventoryDom.querySelector(".magic").classList.remove("disabled")}this.healthBar.set(GameData.player.hp[0],GameData.player.hp[1]);this.magicBar.set(GameData.player.mp[0],GameData.player.mp[1])},setupInventoryButton:function(){var a=dom.findId("open-inventory-button");a.style.display="block";window.currentGame.inventoryPopUp=new Popup("inventory-popup",this.checkInventory.bind(this));this.applyInventorySelectBoxListeners();a.onclick=function(){window.currentGame.inventoryPopUp.show()}},applyInventorySelectBoxListeners:function(){this.weaponSelectBox.onchange=this.setSelectedWeapon.bind(this);this.armorSelectBox.onchange=this.setSelectedArmor.bind(this)},setSelectedWeapon:function(b){var a=typeof(b)=="string"?b:b.target.value;$.setSelectBoxSelected(this.weaponSelectBox,a);window.currentGame.player.setCurrentWeapon(a)},setSelectedArmor:function(b){var a=typeof(b)=="string"?b:b.target.value;$.setSelectBoxSelected(this.armorSelectBox,a);window.currentGame.player.setCurrentArmor(a)},updateGraphicalWeaponPreview:function(a){var b=dom.find("#inventory-stash .weapons .weapon-preview span",true);$.each(window.Weapons[a].large_graphic,function(d,c){b[d].innerHTML=c})},updateGraphicalArmorPreview:function(b){var a=dom.find("#inventory-stash .armors .armor-preview span",true);$.each(window.Armors[b].large_graphic,function(d,c){a[d].innerHTML=c})},addItem:function(a,b){GameData.player.inventory[a].push(b.identifier);b.add();this.checkInventory()}};function Inventory(){this.inventoryDom=dom.find("#inventory-stash");this.weaponSelectBox=dom.find("#inventory-stash #select-weapons select");this.armorSelectBox=dom.find("#inventory-stash #select-armor select");this.healthBar=new StatBar("#inventory-stash #health",".health-stats-left",".total-health",".healthbar .inner-bar");this.magicBar=new StatBar("#inventory-stash #magic",".magic-stats-left",".total-magic",".magicbar .inner-bar");this.healthBar.set(GameData.player.hp[0],GameData.player.hp[1]);this.magicBar.set(GameData.player.mp[0],GameData.player.mp[1])}var InventoryItem=(function(){var b={};d.prototype={add:function(){this.item=b[this.itemScope].call(this);dom.find("#inventory-stash ."+a.call(this)).appendChild(this.item)}};function c(){var e=$.titleize(this.itemScope);return window[e][this.identifier]}function a(){switch(this.itemScope){case"weapons":return this.itemScope+" #select-weapons select";break;case"armors":return this.itemScope+" #select-armor select";break;case"items":case"magic":return this.itemScope;break}}b={items:function(){var e=document.createElement("a");e.id=this.identifier;e.innerHTML=this.itemOptions.title;e.title=this.itemOptions.description;e.onclick=this.itemOptions.use;return e},weapons:function(){var e=document.createElement("option");e.innerHTML=this.itemOptions.title;e.title=this.itemOptions.description;e.value=this.identifier;return e},armors:function(){var e=document.createElement("option");e.innerHTML=this.itemOptions.title;e.title=this.itemOptions.description;e.value=this.identifier;return e},magic:function(){var e=document.createElement("a");e.id=this.identifier;e.innerHTML=this.itemOptions.title;e.title=this.itemOptions.description;return e}};function d(e,f){this.identifier=e;this.itemScope=f;this.itemOptions=c.call(this)}return d})();var Player=(function(){a.prototype={buy:function(c){var d=sellPrices[c];if(GameData.player[d.type]>=d.value){var b=d.type.substring(0,d.type.length-1);window.currentStats.increaseStat(c,1);window.currentStats.increaseStat(b,(d.value*-1))}},canBuyItem:function(b){var c=GameData.player[sellPrices[b].type];return c>=sellPrices[b].value},attack:function(){window.currentBattle.eventEngine.add({type:"player_battle_move",message:"You attacked",perform:window.Animations.Attack.play})},magicAttack:function(b){window.currentBattle.eventEngine.add({type:"player_battle_move",message:"You cast "+b,perform:window.Animations.Magic[b].play})},calculateDamage:function(){return GameData.player.attack_damage*this.weapon().damage},looseHealth:function(b){GameData.player.hp[0]-=Math.round(b);if(GameData.player.hp[0]<=0){GameData.player.hp[0]=0;window.currentBattle.eventEngine.add({type:"death",message:"You lost",timeOut:2000});window.currentBattle.eventEngine.add({type:"end",timeOut:2000})}this.healthBar.update(GameData.player.hp[0])},increaseHealth:function(b){GameData.player.hp[0]+=b;if(GameData.player.hp[0]>=GameData.player.hp[1]){GameData.player.hp[0]=GameData.player.hp[1]}this.healthBar.set(GameData.player.hp[0],GameData.player.hp[1]);this.inventory.healthBar.set(GameData.player.hp[0],GameData.player.hp[1])},increaseMagic:function(b){GameData.player.mp[0]+=b;if(GameData.player.mp[0]>=GameData.player.mp[1]){GameData.player.mp[0]=GameData.player.mp[1]}this.magicBar.set(GameData.player.mp[0],GameData.player.mp[1]);this.inventory.magicBar.set(GameData.player.mp[0],GameData.player.mp[1])},getGraphic:function(){return this.graphic.innerHTML},spawn:function(){this.playerPlaceholder=dom.find("#battle-sequence-popup .field .player #graphic");this.playerPlaceholder.innerHTML=this.getGraphic()},unspawn:function(){this.playerPlaceholder.innerHTML=""},setCurrentWeapon:function(b){window.GameData.player.weapon=b;this.updateWeaponGraphics(b)},updateWeaponGraphics:function(b){var c=this.graphic.querySelectorAll(".weapon");$.each(window.Weapons[b].graphic,function(e,d){c[e].innerHTML=d});this.inventory.updateGraphicalWeaponPreview(b)},setCurrentArmor:function(b){window.GameData.player.armor=b;this.updateArmorGraphics(b)},armor:function(){return window.Armors[window.GameData.player.armor]},weapon:function(){return window.Weapons[window.GameData.player.weapon]},updateArmorGraphics:function(c){var b=this.graphic.querySelectorAll(".armor");$.each(window.Armors[c].graphic,function(e,d){b[e].innerHTML=d});this.inventory.updateGraphicalArmorPreview(c)},loadCurrentArmor:function(){if(window.GameData.player.armor){this.inventory.setSelectedArmor(window.GameData.player.armor)}},loadCurrentWeapon:function(){if(window.GameData.player.weapon){this.inventory.setSelectedWeapon(window.GameData.player.weapon)}},prepareForBattle:function(){this.healthBar.set(GameData.player.hp[0],GameData.player.hp[1]);$.each(["skills","magic","items"],function(b,c){dom.find("#battle-sequence-popup ."+c+" ul.list").innerHTML="";$.each(GameData.player.inventory[c],function(d,e){new BattleItem(e,c).add()})})}};function a(){this.inventory=new Inventory();this.graphic=dom.findId("game-character");this.battleGraphic=dom.find("#battle-sequence-popup .player #graphic");this.attackBar=new Bar(".field .player .attackbar .attack-left",GameData.player.battle_timeout);this.healthBar=new StatBar(".player #health",".health-stats-left",".total-health",".healthbar .inner-bar");this.magicBar=new StatBar(".player #magic",".magic-stats-left",".total-magic",".magicbar .inner-bar");this.healthBar.set(GameData.player.hp[0],GameData.player.hp[1]);this.magicBar.set(GameData.player.mp[0],GameData.player.mp[1])}return a})();var Enemy=(function(){c.prototype={startAttacking:function(){this.attackHoldBar.resetBar();this.attackInterval=setInterval(this.attack.bind(this),this.enemyInformation.attack_interval)},attack:function(){var e=this.pickAttack();var f=this;window.currentBattle.eventEngine.add({message:(this.enemyInformation.name+" attacked with "+e.name),perform:function(){f.attackWith(e)},eventTime:2000})},quitAttacking:function(){clearInterval(this.attackInterval)},pickAttack:function(){var e=[];for(var g in this.enemyInformation.attacks){for(var f=0;f<this.enemyInformation.attacks[g].probability;f++){e.push(this.enemyInformation.attacks[g])}}picked_attack=Math.round(Math.random()*(e.length-1));return e[picked_attack]},attackWith:function(e){window.currentGame.player.looseHealth(this.calculateAttackDamage(e));this.attackHoldBar.resetBar()},calculateAttackDamage:function(e){return(e.damage-(e.damage*window.currentGame.player.armor().damage_reduction))},getEnemyStats:function(){return Enemies[this.identifier]},looseHealth:function(e){this.enemyInformation.health-=e;if(this.enemyInformation.health<=0){this.enemyInformation.health=0;window.currentBattle.eventEngine.add({type:"death",timeOut:2000});a.bind(this)();this.quitAttacking();if(this.enemyInformation.endingCallback){this.enemyInformation.endingCallback()}window.currentBattle.eventEngine.add({type:"end",timeOut:5000})}this.healthBar.update(this.enemyInformation.health)},rememberTotalHealth:function(){this.totalHealth=this.enemyInformation.health},restoreHealth:function(){this.enemyInformation.health=this.totalHealth},getGraphic:function(){return this.enemyPre.innerHTML},spawn:function(){b.bind(this)();d.bind(this)();this.rememberTotalHealth()},unspawn:function(){this.enemyPlaceholder.innerHTML=""}};function a(){var e=this;$.each(["experience","stats","items"],function(f,g){if(e.enemyInformation.rewards[g]){new Rewarder(g,e.enemyInformation.rewards).reward()}})}function b(){this.enemyPosition=dom.find("#battle-sequence-popup .field .enemy");this.enemyPosition.style.top=this.enemyInformation.position.y+"px";this.enemyPosition.style.right=this.enemyInformation.position.x+"px"}function d(){this.enemyPlaceholder=dom.find("#battle-sequence-popup .field .enemy #graphic");this.enemyPlaceholder.innerHTML=this.getGraphic()}function c(e,f){this.identifier=e;this.callbacks=f;this.enemyPre=dom.find(".enemies #"+e);this.enemyInformation=this.getEnemyStats();this.attackHoldBar=new Bar(".field .enemy .attackbar .attack-left",this.enemyInformation.attack_interval);this.healthBar=new StatBar(".field .enemy",".health-stats .health-stats-left",".health-stats .total-health",".healthbar .health-left");this.attackInterval=null;this.healthBar.set(this.enemyInformation.health,this.enemyInformation.health)}return c})();Rewarder.prototype={reward:function(){$.each(this.rewardedItems(),this.rewardSingleItem.bind(this))},rewardSingleItem:function(b,c){var a=this;window.currentBattle.eventEngine.add({message:a.rewardMessage(c),timeOut:2000});this[this.typeOfReward+"RewardCallback"](c)},rewardMessage:function(b){var a="You receive ";if(this.typeOfReward=="stats"){a+=this.rewards[b]+" "+b;if(this.rewards[b]>1){a+="s"}}else{if(this.typeOfReward=="items"){a+=("a "+b)}else{a+=this.rewards[b]+" experience"}}return a},statsRewardCallback:function(a){window.currentStats.increaseStat(a,this.rewards[a])},itemsRewardCallback:function(c){var a=this.rewards[c];switch(c){case"weapon":var b=new Weapon(a);window.currentGame.player.inventory.addItem("weapons",b);break;case"item":var b=new InventoryItem(a,"items");window.currentGame.player.inventory.addItem("items",b);break;case"map":GameData.player.map=a;break}},experienceRewardCallback:function(a){window.currentGame.callbacks.experienceCallbacks.increaseExperience(this.rewards[a])},rewardedItems:function(){return Object.keys(this.rewards)}};function Rewarder(a,b){this.typeOfReward=a;this.rewards=b[a]}BattleInfoHeader.prototype={update:function(a){this.infoHeader.innerHTML=a;this.showText()},showText:function(){clearTimeout(this.messageTimeout);move(this.infoHeader).set("opacity",1).duration(0).end(this.endMessageCallback.bind(this))},endMessageCallback:function(){var a=this;this.messageTimeout=setTimeout(function(){a.hide()},2000)},hide:function(){move(this.infoHeader).duration(200).set("opacity",0).end(self.clear);clearTimeout(this.messageTimeout)},clear:function(){this.infoHeader.innerHTML=""},reset:function(){clearTimeout(this.messageTimeout);this.clear();move(this.infoHeader).set("opacity",1).duration(0).end()}};function BattleInfoHeader(){this.infoHeader=dom.findId("battle-sequence-info-header")}Battle.prototype={start:function(){this.initialize();window.currentBattle=this},stop:function(){this.clear();window.currentBattle=null;delete window.currentBattle},pause:function(){this.controls.lock.bind(this)();this.controls.disable.bind(this)();this.enemy.quitAttacking()},initialize:function(){window.currentGame.player.prepareForBattle();this.graphic.fill.bind(this)();this.battlePopup.show();this.controls.unlock.bind(this)();this.controls.enable.bind(this)();this.enemy.startAttacking();this.startCallback()},clear:function(){this.graphic.unfill.bind(this)();this.controls.disable.bind(this)();this.eventEngine.clear();this.enemy.quitAttacking();this.enemy.restoreHealth();this.endCallback()},canBattle:function(){return window.GameData.player.hp[0]>0},controls:{lock:function(){this.battleControls.lock()},unlock:function(){this.battleControls.unlock()},enable:function(){window.currentGame.player.attackBar.resetBar(this.battleControls.enable.bind(this.battleControls))},disable:function(){this.battleControls.removePlayerAttackListeners()}},graphic:{fill:function(){this.enemy.spawn();window.currentGame.player.spawn()},unfill:function(){this.enemy.unspawn();window.currentGame.player.unspawn()}}};function Battle(a,b,c){this.enemy=a;this.startCallback=b||function(){};this.endCallback=c||function(){};this.battleControls=new BattleControls(this.enemy);this.eventEngine=new BattleEventEngine();this.battlePopup=new Popup("battle-sequence-popup",undefined,this.stop.bind(this))}BattleInitializer.prototype={start:function(b,c,d){var a=new Enemy(b);this.battle=new Battle(a,c,d);if(this.battle.canBattle()){this.battle.start()}}};function BattleInitializer(){}$.domReady(function(){window.BattleInitializer=new BattleInitializer()});ClickArea.prototype={clickAreaMethod:function(){this.clickMethod.apply(null,this.args)},toggle:function(){this.enabled()?this.enable():this.disable()},enabled:function(){return dom.find(this.identifier+".disabled",true).length==0},enable:function(){var a=this;this.applyMethodToclickParts(function(b,c){c.onclick=a.clickAreaMethod.bind(a)})},disable:function(){this.applyMethodToclickParts(function(a,b){b.onclick=null})},applyMethodToclickParts:function(a){$.each(this.clickElement,a.bind(this))}};function ClickArea(b,a,c){this.identifier=b;this.clickMethod=a||function(){};this.arguments=c||[];this.clickElement=dom.find(b,true)}var Level=(function(){l.prototype={addToGame:function(){g.bind(this)();b.bind(this)()},setClickMethodsToLevel:function(){$.each(this.clickAreas,d.bind(this))}};function b(){GameData.player.last_visited=this.identifier;f.bind(this)();this.setClickMethodsToLevel();c.bind(this)();window.currentGame.gameMap.disableMapSpot(this.mapSpot);window.currentLevel=this}function g(){if(window.currentLevel){i.bind(window.currentLevel)();a.bind(window.currentLevel)();k.bind(window.currentLevel)();window.currentGame.gameMap.enableMapSpot(window.currentLevel.mapSpot);window.currentLevel=null;delete window.currentLevel}}function a(){this.clickArea=[]}function c(){if(this.levelModule&&this.levelModule.initialize){this.levelModule.initialize()}}function k(){if(this.levelModule&&this.levelModule.destroy){this.levelModule.destroy()}}function f(){this.levelDom.style.display="block"}function i(){this.levelDom.style.display="none"}function d(o,p){var n=$.methodize(p);new ClickArea(p,this.clickMethods[n]).toggle()}function j(){if(window.LevelClickMethods[this.moduleName]){return window.LevelClickMethods[this.moduleName]}else{return{}}}function e(){if(window.ClickAreas[this.identifier]){return window.ClickAreas[this.identifier]}else{return[]}}function h(){if(window[this.moduleName]){return window[this.moduleName]}else{return{}}}function m(){return window.currentGame.gameMap.findMapSpot(this.mapSpot)}function l(n,o){this.identifier=n;this.mapSpot=o||n;this.levelDom=dom.find("#game-levels #"+n);this.moduleName=$.constantize(n);this.pointOnMap=m.bind(this)();this.levelModule=h.bind(this)();this.clickAreas=e.bind(this)();this.clickMethods=j.bind(this)()}return l})();var Game=(function(){var c=null;var k=5000;var g;d.prototype={initialize:function(){if($.isBrowserCompatible()){GameData.settings.autoSaveEnabled=true;this.player=new Player();this.gameMap=new GameMap();g=GameStorage.get("koo-koo-island-gid")||$.guid();i.call(this);a.call(this);m.call(this);e.call(this);l.call(this);j.call(this)}else{alert("Your browser is not compatible to play this game.")}},save:function(){new Flash("saved").show();GameStorage.store(g,this.getCurrentGame())},loadGame:function(o){GameStorage.store(g,o);window.GameData=JSON.parse(atob(GameStorage.get(g)));h.call(this)},getCurrentGame:function(){return btoa(JSON.stringify(window.GameData))},toggleAutoSave:function(){GameData.settings.autoSaveEnabled=!GameData.settings.autoSaveEnabled;j.call(this)},checkProgressOn:function(o){return GameData.progress[o]==1}};function a(){this.levels[GameData.player.last_visited].addToGame()}function i(){this.levels={};var o=this;for(var p in window.Levels){this.levels[p]=new Level(p);$.each(window.Levels[p],function(r,q){o.levels[q]=new Level(q,p)})}}function m(){this.callbacks={};this.callbacks.loadCallbacks=LoadCallbacks;this.callbacks.experienceCallbacks=ExperienceCallbacks;this.callbacks.statsCallbacks=StatsCallbacks;if(ENV=="production"){delete LoadCallbacks,ExperienceCallbacks,StatsCallbacks}}function e(){if(!GameStorage.keyExists("koo-koo-island-gid")){GameStorage.store("koo-koo-island-gid",g);this.save()}}function l(){if(!(ENV==="development")){window.GameData=JSON.parse(atob(GameStorage.get(g)))}h.call(this)}function j(){if(GameData.settings.autoSaveEnabled){c=setInterval(this.save.bind(this),k)}else{clearInterval(c)}}function h(){n.call(this);b.call(this);f.call(this);this.callbacks.loadCallbacks.setupPlayer()}function n(){var o=this;$.each(Object.keys(window.GameData.progress),function(q,p){if(o.checkProgressOn(p)){o.callbacks.loadCallbacks[p]()}})}function f(){if(this.player.inventory.hasSomethingInInventory()){this.callbacks.loadCallbacks.setupInventory()}}function b(){var o=this;$.each(["seashell","oyster","wood"],function(p,q){if(window.GameData.player[q+"s"]>0){o.callbacks.loadCallbacks.show_stat(q)}})}function d(){}return d})();Controls.prototype={initializeAutoSaveButton:function(){this.changeAutoSaveButtonText();this.autoSaveButton.onclick=function(){window.currentGame.toggleAutoSave();this.changeAutoSaveButtonText()}},initializeSaveButton:function(){this.saveButton.onclick=function(){window.currentGame.save()}},initializeLoadButton:function(){var a=new Popup("load-game-popup",this.load.initializeLoadPopupButtons.bind(this),this.load.disableLoadPopupButtons.bind(this));this.loadButton.onclick=function(){a.show()}},changeAutoSaveButtonText:function(){this.autoSaveButton.innerHTML=this.getAutoSaveText()},getAutoSaveText:function(){if(GameData.settings.autoSaveEnabled){return"Auto save: on"}else{return"Auto save: off"}},load:{initializeLoadPopupButtons:function(){var a=this;this.getCurrentSaveGame.onclick=function(){var b=window.currentGame.getCurrentGame();a.loadGameForm.innerHTML=b};this.loadGameButton.onclick=function(){var b=confirm("Are you sure you want to load this game?");if(b){window.currentGame.loadGame(a.loadGameForm.value);window.location.reload()}}},disableLoadPopupButtons:function(){this.getCurrentSaveGame=null;this.loadGameButton.onclick=null;this.loadGameForm.innerHTML=""}}};function Controls(){this.saveButton=dom.findId("save");this.autoSaveButton=dom.findId("auto-save");this.loadButton=dom.find("button#load");this.getCurrentSaveGame=dom.findId("get-current-game");this.loadGameButton=dom.findId("load-current-game");this.loadGameForm=dom.find("textarea#load-game-form")}window.enableControls=(function(){window.currentControls=new Controls();window.currentControls.initializeAutoSaveButton();window.currentControls.initializeSaveButton();window.currentControls.initializeLoadButton()});$.domReady(function(){window.currentGame=new Game();window.currentGame.initialize();window.currentStats=new Stats();enableControls()});